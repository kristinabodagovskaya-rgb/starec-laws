-- –¢–∞–±–ª–∏—Ü—ã –¥–ª—è v2.0 –°–∏—Ç—É–∞—Ü–∏–∏
-- –ó–∞–ø—É—Å—Ç–∏—Ç—å: psql -U postgres -d starec_laws -f create_v2_tables.sql

-- –ü—Ä–∞–≤–æ–≤—ã–µ —Ä–µ–∂–∏–º—ã (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–∏—Ç—É–∞—Ü–∏–π)
CREATE TABLE IF NOT EXISTS legal_regimes (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    category VARCHAR(100),  -- '–≥—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–µ', '—É–≥–æ–ª–æ–≤–Ω–æ–µ', '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–µ', etc.
    description TEXT,
    parent_regime_id INTEGER REFERENCES legal_regimes(id),
    icon VARCHAR(50),  -- emoji –∏–ª–∏ –∏–∫–æ–Ω–∫–∞
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –ü—Ä–∞–≤–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Ä–µ–∂–∏–º–∞)
CREATE TABLE IF NOT EXISTS legal_states (
    id SERIAL PRIMARY KEY,
    regime_id INTEGER NOT NULL REFERENCES legal_regimes(id) ON DELETE CASCADE,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    consequences TEXT,  -- –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
    actions TEXT,  -- —á—Ç–æ –¥–µ–ª–∞—Ç—å
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –°–≤—è–∑—å —Å–æ—Å—Ç–æ—è–Ω–∏–π —Å –∑–∞–∫–æ–Ω–∞–º–∏ (–∫–∞–∫–∏–µ —Å—Ç–∞—Ç—å–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è)
CREATE TABLE IF NOT EXISTS state_law_references (
    id SERIAL PRIMARY KEY,
    state_id INTEGER NOT NULL REFERENCES legal_states(id) ON DELETE CASCADE,
    law_id INTEGER NOT NULL REFERENCES law_embeddings(id),
    article_number VARCHAR(50),  -- –Ω–æ–º–µ—Ä —Å—Ç–∞—Ç—å–∏
    relevance_note TEXT,  -- –ø–æ—á–µ–º—É –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX IF NOT EXISTS idx_legal_regimes_category ON legal_regimes(category);
CREATE INDEX IF NOT EXISTS idx_legal_regimes_parent ON legal_regimes(parent_regime_id);
CREATE INDEX IF NOT EXISTS idx_legal_states_regime ON legal_states(regime_id);
CREATE INDEX IF NOT EXISTS idx_state_law_refs_state ON state_law_references(state_id);
CREATE INDEX IF NOT EXISTS idx_state_law_refs_law ON state_law_references(law_id);

-- –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–æ–≤—ã–µ —Ä–µ–∂–∏–º—ã
INSERT INTO legal_regimes (name, category, description, icon) VALUES
('–ó–∞—â–∏—Ç–∞ –ø—Ä–∞–≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π', '–≥—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–µ', '–°–∏—Ç—É–∞—Ü–∏–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø–æ–∫—É–ø–∫–æ–π —Ç–æ–≤–∞—Ä–æ–≤ –∏ —É—Å–ª—É–≥', 'üõí'),
('–¢—Ä—É–¥–æ–≤—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è', '—Ç—Ä—É–¥–æ–≤–æ–µ', '–û—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–º –∏ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ–º', 'üíº'),
('–ñ–∏–ª–∏—â–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã', '–∂–∏–ª–∏—â–Ω–æ–µ', '–ê—Ä–µ–Ω–¥–∞, –ø–æ–∫—É–ø–∫–∞, –ñ–ö–•', 'üè†'),
('–°–µ–º–µ–π–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è', '—Å–µ–º–µ–π–Ω–æ–µ', '–ë—Ä–∞–∫, —Ä–∞–∑–≤–æ–¥, –∞–ª–∏–º–µ–Ω—Ç—ã, –æ–ø–µ–∫–∞', 'üë®‚Äçüë©‚Äçüëß'),
('–ù–∞—Å–ª–µ–¥—Å—Ç–≤–æ', '–≥—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–µ', '–í—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–æ, –∑–∞–≤–µ—â–∞–Ω–∏—è', 'üìú'),
('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–æ–Ω–∞—Ä—É—à–µ–Ω–∏—è', '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–µ', '–®—Ç—Ä–∞—Ñ—ã, –Ω–∞—Ä—É—à–µ–Ω–∏—è –ü–î–î', 'üöó'),
('–£–≥–æ–ª–æ–≤–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å', '—É–≥–æ–ª–æ–≤–Ω–æ–µ', '–ü—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è –∏ –Ω–∞–∫–∞–∑–∞–Ω–∏—è', '‚öñÔ∏è'),
('–ù–∞–ª–æ–≥–∏', '–Ω–∞–ª–æ–≥–æ–≤–æ–µ', '–ù–î–§–õ, –≤—ã—á–µ—Ç—ã, –¥–µ–∫–ª–∞—Ä–∞—Ü–∏–∏', 'üìä'),
('–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–æ', '–≥—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–µ', '–ò–ü, –û–û–û, –¥–æ–≥–æ–≤–æ—Ä—ã', 'üè¢'),
('–ó–µ–º–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã', '–∑–µ–º–µ–ª—å–Ω–æ–µ', '–£—á–∞—Å—Ç–∫–∏, –º–µ–∂–µ–≤–∞–Ω–∏–µ, –∫–∞–¥–∞—Å—Ç—Ä', 'üåç')
ON CONFLICT DO NOTHING;

-- –ü—Ä–∏–º–µ—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è "–ó–∞—â–∏—Ç–∞ –ø—Ä–∞–≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π"
INSERT INTO legal_states (regime_id, name, description, consequences, actions)
SELECT r.id, s.name, s.description, s.consequences, s.actions
FROM legal_regimes r
CROSS JOIN (VALUES
    ('–ù–µ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä', '–ö—É–ø–ª–µ–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä –∏–º–µ–µ—Ç –¥–µ—Ñ–µ–∫—Ç—ã –∏–ª–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—é',
     '–ü—Ä–∞–≤–æ –Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç, –æ–±–º–µ–Ω, —Ä–µ–º–æ–Ω—Ç –∏–ª–∏ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ü–µ–Ω—ã',
     '1. –°–æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–µ—Ç–µ–Ω–∑–∏—é –ø—Ä–æ–¥–∞–≤—Ü—É\n2. –ü—Ä–∏ –æ—Ç–∫–∞–∑–µ - –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –†–æ—Å–ø–æ—Ç—Ä–µ–±–Ω–∞–¥–∑–æ—Ä\n3. –ü–æ–¥–∞—Ç—å –∏—Å–∫ –≤ —Å—É–¥'),
    ('–ù–∞–≤—è–∑—ã–≤–∞–Ω–∏–µ —É—Å–ª—É–≥', '–ü—Ä–æ–¥–∞–≤–µ—Ü –≤–∫–ª—é—á–∏–ª –≤ –¥–æ–≥–æ–≤–æ—Ä —É—Å–ª—É–≥–∏ –±–µ–∑ —Å–æ–≥–ª–∞—Å–∏—è',
     '–ü—Ä–∞–≤–æ –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç –Ω–∞–≤—è–∑–∞–Ω–Ω—ã—Ö —É—Å–ª—É–≥ –∏ –≤–µ—Ä–Ω—É—Ç—å –¥–µ–Ω—å–≥–∏',
     '1. –ù–∞–ø–∏—Å–∞—Ç—å –∑–∞—è–≤–ª–µ–Ω–∏–µ –æ–± –æ—Ç–∫–∞–∑–µ\n2. –ü–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤'),
    ('–ù–∞—Ä—É—à–µ–Ω–∏–µ —Å—Ä–æ–∫–æ–≤', '–ü—Ä–æ–¥–∞–≤–µ—Ü –Ω–µ –¥–æ—Å—Ç–∞–≤–∏–ª —Ç–æ–≤–∞—Ä –≤ —Å—Ä–æ–∫',
     '–ü—Ä–∞–≤–æ –Ω–∞ –Ω–µ—É—Å—Ç–æ–π–∫—É 0.5% –∑–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–æ—Å—Ä–æ—á–∫–∏',
     '1. –ù–∞–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–µ—Ç–µ–Ω–∑–∏—é\n2. –ü–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –Ω–µ—É—Å—Ç–æ–π–∫—É'),
    ('–û—Ç–∫–∞–∑ –≤ –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω–æ–º —Ä–µ–º–æ–Ω—Ç–µ', '–°–µ—Ä–≤–∏—Å –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç –≤ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º —Ä–µ–º–æ–Ω—Ç–µ',
     '–ü—Ä–∞–≤–æ –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ä–µ–º–æ–Ω—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω–æ–≥–æ —Å—Ä–æ–∫–∞',
     '1. –ü–æ–ª—É—á–∏—Ç—å –ø–∏—Å—å–º–µ–Ω–Ω—ã–π –æ—Ç–∫–∞–∑\n2. –ü—Ä–æ–≤–µ—Å—Ç–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—É—é —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—É\n3. –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ —Å—É–¥')
) AS s(name, description, consequences, actions)
WHERE r.name = '–ó–∞—â–∏—Ç–∞ –ø—Ä–∞–≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π'
ON CONFLICT DO NOTHING;

-- –ü—Ä–∏–º–µ—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è "–¢—Ä—É–¥–æ–≤—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è"
INSERT INTO legal_states (regime_id, name, description, consequences, actions)
SELECT r.id, s.name, s.description, s.consequences, s.actions
FROM legal_regimes r
CROSS JOIN (VALUES
    ('–ù–µ–∑–∞–∫–æ–Ω–Ω–æ–µ —É–≤–æ–ª—å–Ω–µ–Ω–∏–µ', '–†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å —É–≤–æ–ª–∏–ª –±–µ–∑ –∑–∞–∫–æ–Ω–Ω—ã—Ö –æ—Å–Ω–æ–≤–∞–Ω–∏–π',
     '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ä–∞–±–æ—Ç–µ, –≤—ã–ø–ª–∞—Ç–∞ —Å—Ä–µ–¥–Ω–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –∑–∞ –≤—ã–Ω—É–∂–¥–µ–Ω–Ω—ã–π –ø—Ä–æ–≥—É–ª',
     '1. –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ —Ç—Ä—É–¥–æ–≤—É—é –∏–Ω—Å–ø–µ–∫—Ü–∏—é\n2. –ü–æ–¥–∞—Ç—å –∏—Å–∫ –≤ —Å—É–¥ –≤ —Ç–µ—á–µ–Ω–∏–µ 1 –º–µ—Å—è—Ü–∞'),
    ('–ù–µ–≤—ã–ø–ª–∞—Ç–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã', '–†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å –∑–∞–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—É',
     '–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è 1/150 —Å—Ç–∞–≤–∫–∏ –¶–ë –∑–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –∑–∞–¥–µ—Ä–∂–∫–∏ + –ø—Ä–∞–≤–æ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞–±–æ—Ç—É',
     '1. –ù–∞–ø–∏—Å–∞—Ç—å –∑–∞—è–≤–ª–µ–Ω–∏–µ –æ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Ä–∞–±–æ—Ç—ã\n2. –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –ø—Ä–æ–∫—É—Ä–∞—Ç—É—Ä—É'),
    ('–û—Ç–∫–∞–∑ –≤ –æ—Ç–ø—É—Å–∫–µ', '–†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å –Ω–µ –æ—Ç–ø—É—Å–∫–∞–µ—Ç –≤ –µ–∂–µ–≥–æ–¥–Ω—ã–π –æ—Ç–ø—É—Å–∫',
     '–ü—Ä–∞–≤–æ –Ω–∞ 28 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π –æ—Ç–ø—É—Å–∫–∞ –µ–∂–µ–≥–æ–¥–Ω–æ',
     '1. –ù–∞–ø–∏—Å–∞—Ç—å –∑–∞—è–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ—Ç–ø—É—Å–∫\n2. –ü—Ä–∏ –æ—Ç–∫–∞–∑–µ - –∂–∞–ª–æ–±–∞ –≤ —Ç—Ä—É–¥–æ–≤—É—é –∏–Ω—Å–ø–µ–∫—Ü–∏—é'),
    ('–ü—Ä–∏–Ω—É–∂–¥–µ–Ω–∏–µ –∫ —É–≤–æ–ª—å–Ω–µ–Ω–∏—é', '–†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å –¥–∞–≤–∏—Ç —á—Ç–æ–±—ã —É–≤–æ–ª–∏–ª—Å—è –ø–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–º—É',
     '–ü—Ä–∞–≤–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç—É, –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –º–æ—Ä–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–¥–∞',
     '1. –ù–µ –ø–∏—Å–∞—Ç—å –∑–∞—è–≤–ª–µ–Ω–∏–µ –ø–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–º—É\n2. –§–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –¥–∞–≤–ª–µ–Ω–∏–µ\n3. –ñ–∞–ª–æ–±–∞ –≤ –ø—Ä–æ–∫—É—Ä–∞—Ç—É—Ä—É')
) AS s(name, description, consequences, actions)
WHERE r.name = '–¢—Ä—É–¥–æ–≤—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è'
ON CONFLICT DO NOTHING;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞
SELECT 'legal_regimes' as table_name, COUNT(*) as count FROM legal_regimes
UNION ALL
SELECT 'legal_states', COUNT(*) FROM legal_states;
